name: æ£€æŸ¥æäº¤ä¿¡æ¯æ ¼å¼

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  check-commits:
    name: éªŒè¯æäº¤ä¿¡æ¯
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: æ£€æŸ¥æäº¤ä¿¡æ¯æ ¼å¼
        run: |
          echo "ğŸ” æ£€æŸ¥ PR ä¸­çš„æäº¤ä¿¡æ¯..."
          
          # è·å– PR ä¸­çš„æ‰€æœ‰æäº¤
          commits=$(git log --format="%s" "origin/${{ github.base_ref }}..origin/${{ github.head_ref }}" 2>/dev/null || git log --format="%s" -n 20)
          
          # æœ‰æ•ˆçš„ type åˆ—è¡¨
          valid_types="init|release|style|feat|fix|docs|refactor|perf|dx|workflow|types|wip|test|build|ci|chore|deps"
          
          failed=0
          
          while IFS= read -r msg; do
            if [ -z "$msg" ]; then
              continue
            fi
            
            # æ£€æŸ¥æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„ type
            if echo "$msg" | grep -qE "($valid_types):"; then
              echo "âœ… $msg"
            else
              echo "âŒ $msg"
              failed=1
            fi
          done <<< "$commits"
          
          if [ $failed -eq 1 ]; then
            echo ""
            echo "âŒ æäº¤ä¿¡æ¯æ ¼å¼é”™è¯¯!"
            echo ""
            echo "æ­£ç¡®æ ¼å¼: <emoji> <type>: <æè¿°>"
            echo ""
            echo "å¯ç”¨çš„ type:"
            echo "  ğŸ‰ init: åˆå§‹åŒ–"
            echo "  âœ¨ feat: æ·»åŠ æ–°åŠŸèƒ½"
            echo "  ğŸ› fix: ä¿®å¤ bug"
            echo "  ğŸ“ docs: æ–‡æ¡£ä¿®æ”¹"
            echo "  ğŸ¨ style: ä»£ç é£æ ¼ä¿®æ”¹"
            echo "  â™»ï¸ refactor: ä»£ç é‡æ„"
            echo "  âš¡ perf: æ€§èƒ½ä¼˜åŒ–"
            echo "  âœ… test: æµ‹è¯•ç”¨ä¾‹"
            echo "  ğŸ”¨ build: æ„å»ºç›¸å…³"
            echo "  ğŸ‘· ci: CI é…ç½®"
            echo "  â“ chore: å…¶å®ƒä¿®æ”¹"
            echo "  â¬†ï¸ deps: ä¾èµ–é¡¹ä¿®æ”¹"
            echo ""
            exit 1
          fi
          
          echo ""
          echo "âœ… æ‰€æœ‰æäº¤ä¿¡æ¯æ ¼å¼æ­£ç¡®!"
